<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atkin Guitars Leave Calendar - Real-time</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233B82F6'><path d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 002 2z'/></svg>">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        }
        .connection-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .connection-indicator.hide {
            opacity: 0;
            transform: translateX(100%);
        }
        .connected { background-color: #10B981; color: white; }
        .disconnected { background-color: #EF4444; color: white; }
        .connecting { background-color: #F59E0B; color: white; }
        .sync-indicator { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            color: white;
            max-width: 300px;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show { transform: translateX(0); }
        .notification.success { background-color: #10B981; }
        .notification.error { background-color: #EF4444; }
        .notification.info { background-color: #3B82F6; }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .sidebar-overlay.show {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useCallback } = React;
        
        // Icon components
        const Calendar = ({ className, style }) => (
            <svg className={className} style={style} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const Users = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
            </svg>
        );

        const UserAdd = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
            </svg>
        );

        const Edit = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
        );

        const Trash = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const X = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const Wifi = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
            </svg>
        );

        const WifiOff = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18.364 5.636l-12.728 12.728m0 0L1.394 14.122m4.242 4.242a5.5 5.5 0 007.778 0m7.778-7.778a10.97 10.97 0 00-3.536-2.464m-6.242 6.242L7.758 8.879m0 0a10.97 10.97 0 00-3.536 2.464" />
            </svg>
        );

        const Menu = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        );

        const ChevronLeft = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
        );

        const UserGroup = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.196-2.12M12 14a3 3 0 100-6 3 3 0 000 6zM7 20h10v-2a4 4 0 00-8 0v2z" />
            </svg>
        );

        const Sync = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        // Simplified Database API for demo
        class DatabaseAPI {
            constructor() {
                this.isOnline = navigator.onLine;
                this.queue = [];
                this.lastSync = null;
                
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.processQueue();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                });
            }

            async makeRequest(endpoint, method = 'GET', data = null) {
                await new Promise(resolve => setTimeout(resolve, Math.random() * 300 + 100));
                
                if (Math.random() < 0.05) {
                    throw new Error('Network error');
                }

                const key = `atkin_realtime_${endpoint.replace('/', '_')}`;
                
                switch (method) {
                    case 'GET':
                        const stored = localStorage.getItem(key);
                        return stored ? JSON.parse(stored) : [];
                    case 'POST':
                    case 'PUT':
                        localStorage.setItem(key, JSON.stringify(data));
                        return data;
                    case 'DELETE':
                        localStorage.removeItem(key);
                        return { success: true };
                    default:
                        throw new Error('Unsupported method');
                }
            }

            async fetchEmployees() {
                try {
                    const employees = await this.makeRequest('employees');
                    return employees.length > 0 ? employees : this.getDefaultEmployees();
                } catch (error) {
                    return this.getDefaultEmployees();
                }
            }

            async fetchLeaveRequests() {
                try {
                    const requests = await this.makeRequest('leave-requests');
                    return requests.map(req => ({
                        ...req,
                        startDate: new Date(req.startDate),
                        endDate: new Date(req.endDate)
                    }));
                } catch (error) {
                    return this.getDefaultLeaveRequests();
                }
            }

            async saveData(type, data) {
                if (!this.isOnline) {
                    this.queue.push({ type, action: 'save', data });
                    throw new Error('Offline - queued for sync');
                }
                
                try {
                    if (type === 'employees') {
                        await this.makeRequest('employees', 'PUT', data);
                    } else {
                        const serializedData = data.map(req => ({
                            ...req,
                            startDate: req.startDate instanceof Date ? req.startDate.toISOString() : req.startDate,
                            endDate: req.endDate instanceof Date ? req.endDate.toISOString() : req.endDate
                        }));
                        await this.makeRequest('leave-requests', 'PUT', serializedData);
                    }
                    return data;
                } catch (error) {
                    this.queue.push({ type, action: 'save', data });
                    throw error;
                }
            }

            async processQueue() {
                if (!this.isOnline || this.queue.length === 0) return;
                
                const queueCopy = [...this.queue];
                this.queue = [];
                
                for (const item of queueCopy) {
                    try {
                        await this.saveData(item.type, item.data);
                    } catch (error) {
                        this.queue.push(item);
                    }
                }
                
                this.lastSync = new Date();
            }

            getDefaultEmployees() {
                return [
                    {
                        id: 1,
                        name: 'Sarah Johnson',
                        department: 'Workshop',
                        totalLeave: 200,
                        usedLeave: 64,
                        avatar: 'SJ',
                        color: '#3B82F6'
                    },
                    {
                        id: 2,
                        name: 'Michael Chen',
                        department: 'Finishing',
                        totalLeave: 160,
                        usedLeave: 32,
                        avatar: 'MC',
                        color: '#10B981'
                    },
                    {
                        id: 3,
                        name: 'Emma Davis',
                        department: 'Administration',
                        totalLeave: 180,
                        usedLeave: 96,
                        avatar: 'ED',
                        color: '#F59E0B'
                    }
                ];
            }

            getDefaultLeaveRequests() {
                return [
                    {
                        id: 1,
                        employeeId: 1,
                        startDate: new Date(2025, 7, 25),
                        endDate: new Date(2025, 7, 29),
                        type: 'Annual Leave',
                        status: 'approved',
                        hours: 40
                    }
                ];
            }
        }

        // Notification system
        const NotificationSystem = ({ notifications, removeNotification }) => {
            useEffect(() => {
                notifications.forEach(notification => {
                    if (notification.autoRemove) {
                        setTimeout(() => {
                            removeNotification(notification.id);
                        }, 5000);
                    }
                });
            }, [notifications, removeNotification]);

            return (
                <div>
                    {notifications.map(notification => (
                        <div
                            key={notification.id}
                            className={`notification ${notification.type} ${notification.show ? 'show' : ''}`}
                        >
                            <div className="flex items-center justify-between">
                                <span>{notification.message}</span>
                                <button
                                    onClick={() => removeNotification(notification.id)}
                                    className="ml-2 text-white hover:text-gray-200"
                                >
                                    âœ•
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        const LeaveCalendar = () => {
          const [currentDate, setCurrentDate] = useState(new Date());
          const [viewMode, setViewMode] = useState('month');
          const [showQuickLeaveModal, setShowQuickLeaveModal] = useState(false);
          const [showEmployeeModal, setShowEmployeeModal] = useState(false);
          const [selectedDate, setSelectedDate] = useState(null);
          const [editingEmployee, setEditingEmployee] = useState(null);
          
          // Real-time sync states
          const [connectionStatus, setConnectionStatus] = useState('connecting');
          const [lastSyncTime, setLastSyncTime] = useState(null);
          const [pendingOperations, setPendingOperations] = useState(0);
          const [notifications, setNotifications] = useState([]);
          const [showConnectionIndicator, setShowConnectionIndicator] = useState(true);
          
          // Sidebar states
          const [showSidebar, setShowSidebar] = useState(false);
          const [currentView, setCurrentView] = useState('calendar'); // 'calendar' or 'team'
          
          // Database API instance
          const [dbApi] = useState(() => new DatabaseAPI());
          
          // Data states
          const [employees, setEmployees] = useState([]);
          const [leaveRequests, setLeaveRequests] = useState([]);
          const [isLoading, setIsLoading] = useState(true);
          
          // Form states
          const [quickLeaveForm, setQuickLeaveForm] = useState({
            employeeId: '1',
            days: 1,
            type: 'Annual Leave'
          });

          const [employeeForm, setEmployeeForm] = useState({
            name: '',
            department: '',
            totalLeave: '160',
            usedLeave: '0',
            color: '#3B82F6'
          });

          const companyBranding = {
            companyName: 'Atkin Guitars',
            primaryColor: '#3B82F6'
          };

          const colorOptions = [
            '#3B82F6', '#10B981', '#F59E0B', '#EF4444', 
            '#8B5CF6', '#06B6D4', '#84CC16', '#F97316'
          ];

          const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
          ];

          // Notification helpers
          const addNotification = useCallback((message, type = 'info', autoRemove = true) => {
            const id = Date.now() + Math.random();
            const notification = { id, message, type, autoRemove, show: false };
            
            setNotifications(prev => [...prev, notification]);
            
            setTimeout(() => {
              setNotifications(prev => 
                prev.map(n => n.id === id ? { ...n, show: true } : n)
              );
            }, 100);
            
            return id;
          }, []);

          const removeNotification = useCallback((id) => {
            setNotifications(prev => 
              prev.map(n => n.id === id ? { ...n, show: false } : n)
            );
            
            setTimeout(() => {
              setNotifications(prev => prev.filter(n => n.id !== id));
            }, 300);
          }, []);

          // Initial data loading
          useEffect(() => {
            const loadInitialData = async () => {
              setIsLoading(true);
              setConnectionStatus('connecting');
              
              try {
                const [employeesData, leaveRequestsData] = await Promise.all([
                  dbApi.fetchEmployees(),
                  dbApi.fetchLeaveRequests()
                ]);
                
                setEmployees(employeesData);
                setLeaveRequests(leaveRequestsData);
                setConnectionStatus('connected');
                setShowConnectionIndicator(true);
                setLastSyncTime(new Date());
                // Removed 'Data loaded successfully' notification
                
                // Hide connection indicator after 3 seconds
                setTimeout(() => {
                  setShowConnectionIndicator(false);
                }, 3000);
              } catch (error) {
                setConnectionStatus('disconnected');
                addNotification('Failed to load data - working offline', 'error');
              } finally {
                setIsLoading(false);
              }
            };
            
            loadInitialData();
          }, [dbApi, addNotification]);

          // Periodic sync
          useEffect(() => {
            const interval = setInterval(async () => {
              if (navigator.onLine && connectionStatus === 'connected') {
                try {
                  await dbApi.processQueue();
                  setLastSyncTime(new Date());
                  setPendingOperations(dbApi.queue.length);
                } catch (error) {
                  console.error('Sync failed:', error);
                }
              }
            }, 30000);

            return () => clearInterval(interval);
          }, [dbApi, connectionStatus]);

          // Connection status monitoring
          useEffect(() => {
            const handleOnline = () => {
              setConnectionStatus('connected');
              setShowConnectionIndicator(true);
              addNotification('Connection restored - syncing data...', 'success');
              dbApi.processQueue();
              
              // Hide connection indicator after 3 seconds when connected
              setTimeout(() => {
                setShowConnectionIndicator(false);
              }, 3000);
            };

            const handleOffline = () => {
              setConnectionStatus('disconnected');
              setShowConnectionIndicator(true);
              addNotification('Working offline - changes will sync when reconnected', 'info');
            };

            window.addEventListener('online', handleOnline);
            window.addEventListener('offline', handleOffline);

            // Hide connection indicator after initial connection
            if (connectionStatus === 'connected') {
              setTimeout(() => {
                setShowConnectionIndicator(false);
              }, 3000);
            }

            return () => {
              window.removeEventListener('online', handleOnline);
              window.removeEventListener('offline', handleOffline);
            };
          }, [dbApi, addNotification, connectionStatus]);

          const generateInitials = (name) => {
            return name.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
          };

          const formatHours = (hours) => {
            const days = Math.floor(hours / 8);
            const remainingHours = hours % 8;
            return remainingHours > 0 ? `${days}d ${remainingHours}h` : `${days}d`;
          };

          // Calendar helper functions
          const getCalendarDays = () => {
            if (viewMode === 'week') {
              return getWeekDays();
            } else if (viewMode === 'year') {
              return getYearMonths();
            } else {
              return getMonthDays();
          const renderTeamMembersView = () => {
            return (
              <div className="max-w-4xl mx-auto px-6 py-8">
                <div className="bg-white rounded-xl shadow-sm border p-6">
                  <div className="flex items-center justify-between mb-6">
                    <h2 className="text-2xl font-bold text-gray-900">Team Members</h2>
                    <button 
                      onClick={() => openEmployeeModal()}
                      className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                    >
                      <UserAdd className="h-4 w-4" />
                      <span>Add Employee</span>
                    </button>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {employees.map(employee => {
                      const remainingHours = employee.totalLeave - employee.usedLeave;
                      const usagePercentage = (employee.usedLeave / employee.totalLeave) * 100;
                      
                      // Get recent leave requests for this employee
                      const recentLeaves = leaveRequests
                        .filter(leave => leave.employeeId === employee.id)
                        .sort((a, b) => new Date(b.startDate) - new Date(a.startDate))
                        .slice(0, 3);
                      
                      return (
                        <div 
                          key={employee.id} 
                          className="bg-gray-50 rounded-lg p-6 hover:shadow-md transition-shadow relative group"
                        >
                          <div className="absolute top-4 right-4 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button
                              onClick={() => openEmployeeModal(employee)}
                              className="p-2 text-gray-400 hover:text-blue-600 transition-colors bg-white rounded-lg shadow-sm"
                            >
                              <Edit className="h-4 w-4" />
                            </button>
                            <button
                              onClick={() => deleteEmployee(employee.id)}
                              className="p-2 text-gray-400 hover:text-red-600 transition-colors bg-white rounded-lg shadow-sm"
                            >
                              <Trash className="h-4 w-4" />
                            </button>
                          </div>
                          
                          <div className="flex items-center space-x-4 mb-4">
                            <div 
                              className="w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-lg"
                              style={{ backgroundColor: employee.color }}
                            >
                              {employee.avatar}
                            </div>
                            <div className="flex-1">
                              <h3 className="text-lg font-semibold text-gray-900">{employee.name}</h3>
                              <p className="text-gray-600">{employee.department}</p>
                            </div>
                          </div>
                          
                          <div className="space-y-3">
                            <div className="grid grid-cols-2 gap-4 text-sm">
                              <div>
                                <span className="text-gray-600">Total Leave:</span>
                                <p className="font-medium">{formatHours(employee.totalLeave)}</p>
                              </div>
                              <div>
                                <span className="text-gray-600">Used:</span>
                                <p className="font-medium">{formatHours(employee.usedLeave)}</p>
                              </div>
                              <div>
                                <span className="text-gray-600">Remaining:</span>
                                <p className="font-medium text-green-600">{formatHours(remainingHours)}</p>
                              </div>
                              <div>
                                <span className="text-gray-600">Usage:</span>
                                <p className="font-medium">{usagePercentage.toFixed(1)}%</p>
                              </div>
                            </div>
                            
                            <div className="w-full bg-gray-200 rounded-full h-3">
                              <div 
                                className="h-3 rounded-full transition-all duration-300"
                                style={{ 
                                  width: `${usagePercentage}%`,
                                  backgroundColor: employee.color 
                                }}
                              />
                            </div>
                            
                            {recentLeaves.length > 0 && (
                              <div className="mt-4">
                                <h4 className="text-sm font-medium text-gray-700 mb-2">Recent Leave</h4>
                                <div className="space-y-1">
                                  {recentLeaves.map(leave => (
                                    <div key={leave.id} className="flex justify-between items-center text-xs">
                                      <span className={`px-2 py-1 rounded ${getStatusColor(leave.status)}`}>
                                        {leave.type}
                                      </span>
                                      <span className="text-gray-500">
                                        {new Date(leave.startDate).toLocaleDateString()}
                                      </span>
                                    </div>
                                  ))}
                                </div>
                              </div>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            );
          };

          const getMonthDays = () => {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const days = [];
            const currentDay = new Date(startDate);
            
            for (let i = 0; i < 42; i++) {
              days.push(new Date(currentDay));
              currentDay.setDate(currentDay.getDate() + 1);
            }
            
            return days;
          };

          const getWeekDays = () => {
            const startOfWeek = new Date(currentDate);
            const day = startOfWeek.getDay();
            startOfWeek.setDate(currentDate.getDate() - day);
            
            const days = [];
            for (let i = 0; i < 7; i++) {
              const day = new Date(startOfWeek);
              day.setDate(startOfWeek.getDate() + i);
              days.push(day);
            }
            return days;
          };

          const getYearMonths = () => {
            const year = currentDate.getFullYear();
            const months = [];
            for (let i = 0; i < 12; i++) {
              months.push(new Date(year, i, 1));
            }
            return months;
          };

          const getLeaveForDate = (date) => {
            return leaveRequests.filter(leave => {
              const leaveStart = new Date(leave.startDate);
              const leaveEnd = new Date(leave.endDate);
              return date >= leaveStart && date <= leaveEnd;
            });
          };

          const getStatusColor = (status) => {
            switch(status) {
              case 'approved': return 'bg-green-100 text-green-800';
              case 'pending': return 'bg-yellow-100 text-yellow-800';
              case 'rejected': return 'bg-red-100 text-red-800';
              default: return 'bg-gray-100 text-gray-800';
            }
          };

          const navigateMonth = (direction) => {
            setCurrentDate(prev => {
              const newDate = new Date(prev);
              if (viewMode === 'week') {
                newDate.setDate(prev.getDate() + (direction * 7));
              } else if (viewMode === 'year') {
                newDate.setFullYear(prev.getFullYear() + direction);
              } else {
                newDate.setMonth(prev.getMonth() + direction);
              }
              return newDate;
            });
          };

          const getViewTitle = () => {
            if (viewMode === 'week') {
              const startOfWeek = new Date(currentDate);
              const day = startOfWeek.getDay();
              startOfWeek.setDate(currentDate.getDate() - day);
              const endOfWeek = new Date(startOfWeek);
              endOfWeek.setDate(startOfWeek.getDate() + 6);
              
              if (startOfWeek.getMonth() === endOfWeek.getMonth()) {
                return `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()}-${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
              } else {
                return `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()} - ${monthNames[endOfWeek.getMonth()]} ${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
              }
            } else if (viewMode === 'year') {
              return currentDate.getFullYear().toString();
            } else {
              return `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            }
          };

          const getGridColumns = () => {
            if (viewMode === 'week') return 'grid-cols-7';
            if (viewMode === 'year') return 'grid-cols-4';
            return 'grid-cols-7';
          };

          // Database operations with real-time sync
          const syncData = async () => {
            try {
              setPendingOperations(prev => prev + 1);
              await dbApi.saveData('employees', employees);
              await dbApi.saveData('leave-requests', leaveRequests);
              addNotification('Data synced successfully', 'success');
            } catch (error) {
              if (error.message.includes('Offline')) {
                addNotification('Changes saved locally - will sync when online', 'info');
              } else {
                addNotification('Sync failed', 'error');
              }
            } finally {
              setPendingOperations(prev => Math.max(0, prev - 1));
            }
          };

          const openQuickLeaveModal = (date) => {
            setSelectedDate(date);
            setQuickLeaveForm({
              employeeId: employees.length > 0 ? employees[0].id.toString() : '1',
              days: 1,
              type: 'Annual Leave'
            });
            setShowQuickLeaveModal(true);
          };

          const closeQuickLeaveModal = () => {
            setShowQuickLeaveModal(false);
            setSelectedDate(null);
          };

          const saveQuickLeave = async () => {
            if (!quickLeaveForm.employeeId || !selectedDate) {
              addNotification('Please select an employee', 'error');
              return;
            }

            const days = parseInt(quickLeaveForm.days) || 1;
            const totalHours = days * 8;
            const employee = employees.find(emp => emp.id === parseInt(quickLeaveForm.employeeId));
            
            if (!employee) {
              addNotification('Please select a valid employee', 'error');
              return;
            }

            const remainingLeave = employee.totalLeave - employee.usedLeave;
            if (totalHours > remainingLeave) {
              addNotification(`Employee only has ${formatHours(remainingLeave)} remaining.`, 'error');
              return;
            }

            const startDate = new Date(selectedDate);
            const endDate = new Date(selectedDate);
            
            if (days > 1) {
              endDate.setDate(startDate.getDate() + days - 1);
            }

            const newLeaveRequest = {
              id: Math.max(...leaveRequests.map(req => req.id), 0) + 1,
              employeeId: parseInt(quickLeaveForm.employeeId),
              startDate: startDate,
              endDate: endDate,
              type: quickLeaveForm.type,
              status: 'pending',
              hours: totalHours
            };

            // Update local state immediately for responsiveness
            setLeaveRequests(prev => [...prev, newLeaveRequest]);
            setEmployees(prev => prev.map(emp => 
              emp.id === parseInt(quickLeaveForm.employeeId)
                ? { ...emp, usedLeave: emp.usedLeave + totalHours }
                : emp
            ));

            // Sync to database
            await syncData();

            closeQuickLeaveModal();
          };

          const openEmployeeModal = (employee = null) => {
            if (employee) {
              setEditingEmployee(employee);
              setEmployeeForm({
                name: employee.name,
                department: employee.department,
                totalLeave: employee.totalLeave.toString(),
                usedLeave: employee.usedLeave.toString(),
                color: employee.color
              });
            } else {
              setEditingEmployee(null);
              setEmployeeForm({
                name: '',
                department: '',
                totalLeave: '160',
                usedLeave: '0',
                color: colorOptions[employees.length % colorOptions.length]
              });
            }
            setShowEmployeeModal(true);
          };

          const closeEmployeeModal = () => {
            setShowEmployeeModal(false);
            setEditingEmployee(null);
          };

          const saveEmployee = async () => {
            if (!employeeForm.name.trim() || !employeeForm.department.trim()) {
              addNotification('Please fill in all required fields', 'error');
              return;
            }

            const totalLeave = parseInt(employeeForm.totalLeave) || 0;
            const usedLeave = parseInt(employeeForm.usedLeave) || 0;

            if (editingEmployee) {
              const updatedEmployee = {
                ...editingEmployee,
                name: employeeForm.name,
                department: employeeForm.department,
                totalLeave: totalLeave,
                usedLeave: usedLeave,
                color: employeeForm.color,
                avatar: generateInitials(employeeForm.name)
              };

              setEmployees(prev => prev.map(emp => 
                emp.id === editingEmployee.id ? updatedEmployee : emp
              ));
            } else {
              const newId = Math.max(...employees.map(emp => emp.id), 0) + 1;
              const newEmployee = {
                id: newId,
                name: employeeForm.name,
                department: employeeForm.department,
                totalLeave: totalLeave,
                usedLeave: usedLeave,
                avatar: generateInitials(employeeForm.name),
                color: employeeForm.color
              };

              setEmployees(prev => [...prev, newEmployee]);
            }
            
            await syncData();
            closeEmployeeModal();
          };

          const deleteEmployee = async (employeeId) => {
            if (confirm('Are you sure you want to delete this employee?')) {
              setEmployees(prev => prev.filter(emp => emp.id !== employeeId));
              await syncData();
            }
          };

          const cancelSingleDayLeave = async (leaveRequest, specificDate) => {
            const employee = employees.find(emp => emp.id === leaveRequest.employeeId);
            if (confirm(`Cancel leave for ${employee?.name} on ${specificDate.toLocaleDateString()}?`)) {
              // Remove the leave request and return hours
              setLeaveRequests(prev => prev.filter(req => req.id !== leaveRequest.id));
              setEmployees(prev => prev.map(emp => 
                emp.id === leaveRequest.employeeId
                  ? { ...emp, usedLeave: emp.usedLeave - leaveRequest.hours }
                  : emp
              ));

              await syncData();
            }
          };

          if (isLoading) {
            return (
              <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                <div className="text-center">
                  <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"></div>
                  <p className="mt-4 text-gray-600">Loading calendar data...</p>
                </div>
              </div>
            );
          }

          const days = getCalendarDays();

          const renderCalendarContent = () => {
            if (viewMode === 'year') {
              return (
                <div className={`grid ${getGridColumns()} gap-4`}>
                  {days.map((month, index) => {
                    const monthLeaves = leaveRequests.filter(leave => {
                      const leaveStart = new Date(leave.startDate);
                      return leaveStart.getMonth() === month.getMonth() && leaveStart.getFullYear() === month.getFullYear();
                    });
                    
                    // Group leaves by employee and calculate totals
                    const employeeMap = new Map();
                    monthLeaves.forEach(leave => {
                      const employeeId = leave.employeeId;
                      if (employeeMap.has(employeeId)) {
                        // Add to existing employee's total
                        const existing = employeeMap.get(employeeId);
                        existing.totalDays += (leave.hours / 8);
                      } else {
                        // Create new entry for this employee
                        employeeMap.set(employeeId, {
                          employeeId: employeeId,
                          status: leave.status,
                          totalDays: (leave.hours / 8)
                        });
                      }
                    });
                    
                    const uniqueEmployeeLeaves = Array.from(employeeMap.values());
                    
                    return (
                      <div key={index} className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" 
                           onClick={() => {
                             setCurrentDate(month);
                             setViewMode('month');
                           }}>
                        <h3 className="font-medium text-gray-900 mb-2">{monthNames[month.getMonth()]}</h3>
                        <div className="space-y-1">
                          {uniqueEmployeeLeaves.slice(0, 3).map(employeeLeave => {
                            const employee = employees.find(emp => emp.id === employeeLeave.employeeId);
                            if (!employee) return null;
                            
                            return (
                              <div key={`${employeeLeave.employeeId}-${month.getMonth()}-${month.getFullYear()}`} className={`text-xs px-2 py-1 rounded flex items-center justify-between ${getStatusColor(employeeLeave.status)}`}>
                                <span className="truncate">{employee.name.split(' ')[0]}</span>
                                <span className="text-xs ml-2">{employeeLeave.totalDays}d</span>
                              </div>
                            );
                          })}
                          {uniqueEmployeeLeaves.length > 3 && (
                            <div className="text-xs text-gray-500">+{uniqueEmployeeLeaves.length - 3} more</div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              );
            } else {
              return (
                <>
                  <div className={`grid ${getGridColumns()} gap-1 mb-2`}>
                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                      <div key={day} className="p-3 text-center text-sm font-medium text-gray-500">
                        {day}
                      </div>
                    ))}
                  </div>
                  <div className={`grid ${getGridColumns()} gap-1`}>
                    {days.map((date, index) => {
                      const isCurrentMonth = viewMode === 'week' || date.getMonth() === currentDate.getMonth();
                      const isToday = date.toDateString() === new Date().toDateString();
                      const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                      const dayLeaves = getLeaveForDate(date);
                      
                      return (
                        <div
                          key={index}
                          className={`${viewMode === 'week' ? 'min-h-[120px]' : 'min-h-[96px]'} p-2 border border-gray-200 hover:bg-gray-50 transition-colors relative group ${
                            !isCurrentMonth ? 'bg-gray-50 text-gray-400' : ''
                          } ${isToday ? 'bg-blue-50 border-blue-200' : ''} ${
                            isWeekend ? 'bg-gray-100' : ''
                          }`}
                        >
                          <div className="flex justify-between items-start mb-1">
                            <div className={`text-sm font-medium ${
                              isToday ? 'text-blue-600' : isCurrentMonth ? 'text-gray-900' : 'text-gray-400'
                            }`}>
                              {viewMode === 'week' ? `${monthNames[date.getMonth()].slice(0,3)} ${date.getDate()}` : date.getDate()}
                            </div>
                            {isCurrentMonth && (
                              <span 
                                onClick={() => openQuickLeaveModal(date)}
                                className="opacity-0 group-hover:opacity-100 transition-opacity w-5 h-5 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs hover:bg-blue-600 cursor-pointer select-none"
                                title="Add leave for this day"
                              >
                                +
                              </span>
                            )}
                          </div>
                          
                          <div className="space-y-1">
                            {dayLeaves.map(leave => {
                              const employee = employees.find(emp => emp.id === leave.employeeId);
                              if (!employee) return null;
                              
                              return (
                                <div
                                  key={`${leave.id}-${date.getTime()}`}
                                  className={`text-xs px-2 py-1 rounded text-center truncate flex items-center justify-between group ${getStatusColor(leave.status)}`}
                                  title={`${employee.name} - ${leave.type}`}
                                >
                                  <span className="truncate flex-1">{employee.name.split(' ')[0]}</span>
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      cancelSingleDayLeave(leave, date);
                                    }}
                                    className="opacity-0 group-hover:opacity-100 ml-1 p-0.5 hover:bg-red-200 rounded transition-all flex-shrink-0"
                                    title="Cancel leave"
                                  >
                                    <X className="h-2 w-2" />
                                  </button>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </>
              );
            }
          };

          return (
            <div className="min-h-screen bg-gray-50">
              {/* Sidebar Overlay */}
              <div 
                className={`sidebar-overlay ${showSidebar ? 'show' : ''}`}
                onClick={() => setShowSidebar(false)}
              />
              
              {/* Sidebar */}
              <div className={`sidebar ${showSidebar ? 'open' : ''}`}>
                <div className="p-6">
                  <div className="flex items-center justify-between mb-8">
                    <div className="flex items-center space-x-2">
                      <Calendar className="h-6 w-6 text-blue-600" />
                      <h2 className="text-lg font-bold text-gray-900">Menu</h2>
                    </div>
                    <button 
                      onClick={() => setShowSidebar(false)}
                      className="p-1 hover:bg-gray-100 rounded-lg transition-colors"
                    >
                      <ChevronLeft className="h-5 w-5 text-gray-500" />
                    </button>
                  </div>
                  
                  <nav className="space-y-2">
                    <button
                      onClick={() => {
                        setCurrentView('calendar');
                        setShowSidebar(false);
                      }}
                      className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors ${
                        currentView === 'calendar' 
                          ? 'bg-blue-50 text-blue-700 border-l-4 border-blue-700' 
                          : 'text-gray-600 hover:bg-gray-50'
                      }`}
                    >
                      <Home className="h-5 w-5" />
                      <span className="font-medium">Calendar</span>
                    </button>
                    
                    <button
                      onClick={() => {
                        setCurrentView('team');
                        setShowSidebar(false);
                      }}
                      className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors ${
                        currentView === 'team' 
                          ? 'bg-blue-50 text-blue-700 border-l-4 border-blue-700' 
                          : 'text-gray-600 hover:bg-gray-50'
                      }`}
                    >
                      <UserGroup className="h-5 w-5" />
                      <span className="font-medium">Team Members</span>
                    </button>
                  </nav>
                </div>
              </div>
              {/* Connection Status Indicator */}
              <div className={`connection-indicator ${connectionStatus} ${!showConnectionIndicator ? 'hide' : ''}`}>
                {connectionStatus === 'connected' && (
                  <>
                    <Wifi className="h-4 w-4" />
                    <span>Connected</span>
                    {pendingOperations > 0 && (
                      <>
                        <Sync className="h-4 w-4 sync-indicator" />
                        <span>{pendingOperations} syncing</span>
                      </>
                    )}
                  </>
                )}
                {connectionStatus === 'disconnected' && (
                  <>
                    <WifiOff className="h-4 w-4" />
                    <span>Offline</span>
                    {dbApi.queue.length > 0 && (
                      <span>({dbApi.queue.length} queued)</span>
                    )}
                  </>
                )}
                {connectionStatus === 'connecting' && (
                  <>
                    <Sync className="h-4 w-4 sync-indicator" />
                    <span>Connecting...</span>
                  </>
                )}
              </div>

              {/* Notifications */}
              <NotificationSystem 
                notifications={notifications} 
                removeNotification={removeNotification} 
              />

              {/* Header */}
              <div className="bg-white shadow-sm border-b">
                <div className="max-w-7xl mx-auto px-6 py-4">
                  <div className="flex items-center justify-between flex-wrap gap-4">
                    <div className="flex items-center space-x-4">
                      <button
                        onClick={() => setShowSidebar(true)}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors lg:hidden"
                      >
                        <Menu className="h-6 w-6 text-gray-600" />
                      </button>
                      
                      <button
                        onClick={() => setShowSidebar(true)}
                        className="hidden lg:flex p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <Menu className="h-6 w-6 text-gray-600" />
                      </button>
                      
                      <div className="flex items-center space-x-2">
                        <Calendar className="h-8 w-8" style={{ color: companyBranding.primaryColor }} />
                        <h1 className="text-2xl font-bold text-gray-900">
                          {companyBranding.companyName} {currentView === 'team' ? 'Team Members' : 'Leave Calendar'}
                        </h1>
                      </div>
                      {lastSyncTime && currentView === 'calendar' && (
                        <div className="text-sm text-gray-500">
                          Last sync: {lastSyncTime.toLocaleTimeString()}
                        </div>
                      )}
                    </div>
                    
                    {currentView === 'calendar' && (
                      <div className="flex items-center space-x-4">
                        <div className="flex bg-gray-100 rounded-lg p-1">
                          {['week', 'month', 'year'].map(mode => (
                            <button
                              key={mode}
                              onClick={() => setViewMode(mode)}
                              className={`px-3 py-1 rounded-md text-sm font-medium capitalize transition-colors ${
                                viewMode === mode 
                                  ? 'bg-white text-gray-900 shadow-sm' 
                                  : 'text-gray-600 hover:text-gray-900'
                              }`}
                            >
                              {mode}
                            </button>
                          ))}
                        </div>
                        
                        <button 
                          onClick={() => openEmployeeModal()}
                          className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                        >
                          <UserAdd className="h-4 w-4" />
                          <span>Add Employee</span>
                        </button>
                        
                        <button 
                          onClick={() => syncData()}
                          className="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                          disabled={pendingOperations > 0}
                        >
                          <Sync className={`h-4 w-4 ${pendingOperations > 0 ? 'sync-indicator' : ''}`} />
                          <span>{pendingOperations > 0 ? 'Syncing...' : 'Sync Now'}</span>
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* Main Content */}
              {currentView === 'calendar' ? (
                <div className="max-w-7xl mx-auto px-6 py-8">
                  <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    {/* Employee Sidebar */}
                    <div className="lg:col-span-1">
                      <div className="bg-white rounded-xl shadow-sm border p-6">
                        <div className="flex items-center justify-between mb-6">
                          <h2 className="text-lg font-semibold text-gray-900">Team Overview</h2>
                          <Users className="h-5 w-5 text-gray-400" />
                        </div>
                        
                        <div className="space-y-4">
                          {employees.map(employee => {
                            const remainingHours = employee.totalLeave - employee.usedLeave;
                            const usagePercentage = (employee.usedLeave / employee.totalLeave) * 100;
                            
                            return (
                              <div 
                                key={employee.id} 
                                className="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow relative group"
                              >
                                <div className="absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                  <button
                                    onClick={() => openEmployeeModal(employee)}
                                    className="p-1 text-gray-400 hover:text-blue-600 transition-colors"
                                  >
                                    <Edit className="h-4 w-4" />
                                  </button>
                                  <button
                                    onClick={() => deleteEmployee(employee.id)}
                                    className="p-1 text-gray-400 hover:text-red-600 transition-colors"
                                  >
                                    <Trash className="h-4 w-4" />
                                  </button>
                                </div>
                                
                                <div className="flex items-center space-x-3 mb-3">
                                  <div 
                                    className="w-10 h-10 rounded-full flex items-center justify-center text-white font-medium"
                                    style={{ backgroundColor: employee.color }}
                                  >
                                    {employee.avatar}
                                  </div>
                                  <div className="flex-1">
                                    <h3 className="font-medium text-gray-900">{employee.name}</h3>
                                    <p className="text-sm text-gray-500">{employee.department}</p>
                                  </div>
                                </div>
                                
                                <div className="space-y-2">
                                  <div className="flex justify-between text-sm">
                                    <span className="text-gray-600">Used:</span>
                                    <span className="font-medium">{formatHours(employee.usedLeave)}</span>
                                  </div>
                                  <div className="flex justify-between text-sm">
                                    <span className="text-gray-600">Remaining:</span>
                                    <span className="font-medium text-green-600">{formatHours(remainingHours)}</span>
                                  </div>
                                  
                                  <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div 
                                      className="h-2 rounded-full transition-all duration-300"
                                      style={{ 
                                        width: `${usagePercentage}%`,
                                        backgroundColor: employee.color 
                                      }}
                                    />
                                  </div>
                                  <div className="text-xs text-gray-500 text-center">
                                    {usagePercentage.toFixed(1)}% used
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    </div>

                    {/* Calendar */}
                    <div className="lg:col-span-3">
                      <div className="bg-white rounded-xl shadow-sm border">
                        <div className="flex items-center justify-between p-6 border-b">
                          <div className="flex items-center space-x-4">
                            <button 
                              onClick={() => navigateMonth(-1)}
                              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                            >
                              â†
                            </button>
                            <h2 className="text-xl font-semibold text-gray-900">
                              {getViewTitle()}
                            </h2>
                            <button 
                              onClick={() => navigateMonth(1)}
                              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                            >
                              â†’
                            </button>
                          </div>
                        </div>

                        <div className="p-6">
                          {renderCalendarContent()}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ) : (
                renderTeamMembersView()
              )}

              {/* Employee Modal */}
              {showEmployeeModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-md">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold">
                        {editingEmployee ? 'Edit Employee' : 'Add New Employee'}
                      </h3>
                      <button 
                        onClick={closeEmployeeModal}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        âœ•
                      </button>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Full Name *
                        </label>
                        <input
                          type="text"
                          value={employeeForm.name}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, name: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          placeholder="e.g., John Smith"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Department *
                        </label>
                        <select
                          value={employeeForm.department}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, department: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="">Select Department</option>
                          <option value="Workshop">Workshop</option>
                          <option value="Finishing">Finishing</option>
                          <option value="Administration">Administration</option>
                          <option value="Sales">Sales</option>
                          <option value="Quality Control">Quality Control</option>
                          <option value="Design">Design</option>
                          <option value="Maintenance">Maintenance</option>
                        </select>
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Annual Leave Allocation (hours)
                        </label>
                        <input
                          type="number"
                          value={employeeForm.totalLeave}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, totalLeave: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          min="0"
                          max="400"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Leave Used (hours)
                        </label>
                        <input
                          type="number"
                          value={employeeForm.usedLeave}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, usedLeave: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          min="0"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Avatar Color
                        </label>
                        <div className="flex flex-wrap gap-2">
                          {colorOptions.map(color => (
                            <button
                              key={color}
                              type="button"
                              onClick={() => setEmployeeForm(prev => ({...prev, color}))}
                              className={`w-8 h-8 rounded-full border-2 transition-all ${
                                employeeForm.color === color ? 'border-gray-800 scale-110' : 'border-gray-300'
                              }`}
                              style={{ backgroundColor: color }}
                            />
                          ))}
                        </div>
                      </div>
                      
                      <div className="flex justify-end space-x-3 pt-4">
                        <button 
                          onClick={closeEmployeeModal}
                          className="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={saveEmployee}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          {editingEmployee ? 'Update Employee' : 'Add Employee'}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Quick Leave Modal */}
              {showQuickLeaveModal && selectedDate && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-md">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold">
                        Quick Add Leave - {selectedDate.toLocaleDateString()}
                      </h3>
                      <button 
                        onClick={closeQuickLeaveModal}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        âœ•
                      </button>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Employee
                        </label>
                        <select
                          value={quickLeaveForm.employeeId}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, employeeId: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          {employees.map(emp => (
                            <option key={emp.id} value={emp.id}>
                              {emp.name}
                            </option>
                          ))}
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Number of Days
                        </label>
                        <select
                          value={quickLeaveForm.days}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, days: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="1">1 Day (8 hours)</option>
                          <option value="2">2 Days (16 hours)</option>
                          <option value="3">3 Days (24 hours)</option>
                          <option value="5">5 Days (40 hours)</option>
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Leave Type
                        </label>
                        <select
                          value={quickLeaveForm.type}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, type: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="Annual Leave">Annual Leave</option>
                          <option value="Sick Leave">Sick Leave</option>
                          <option value="Personal Leave">Personal Leave</option>
                        </select>
                      </div>
                      
                      <div className="flex justify-end space-x-3 pt-4">
                        <button 
                          onClick={closeQuickLeaveModal}
                          className="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={saveQuickLeave}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          Add Leave
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Render the app
        ReactDOM.render(<LeaveCalendar />, document.getElementById('root'));
    </script>
</body>
</html>">{employee.name}</h3>
                                    <p className="text-sm text-gray-500">{employee.department}</p>
                                  </div>
                                </div>
                                
                                <div className="space-y-2">
                                  <div className="flex justify-between text-sm">
                                    <span className="text-gray-600">Used:</span>
                                    <span className="font-medium">{formatHours(employee.usedLeave)}</span>
                                  </div>
                                  <div className="flex justify-between text-sm">
                                    <span className="text-gray-600">Remaining:</span>
                                    <span className="font-medium text-green-600">{formatHours(remainingHours)}</span>
                                  </div>
                                  
                                  <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div 
                                      className="h-2 rounded-full transition-all duration-300"
                                      style={{ 
                                        width: `${usagePercentage}%`,
                                        backgroundColor: employee.color 
                                      }}
                                    />
                                  </div>
                                  <div className="text-xs text-gray-500 text-center">
                                    {usagePercentage.toFixed(1)}% used
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    </div>

                    {/* Calendar */}
                    <div className="lg:col-span-3">
                      <div className="bg-white rounded-xl shadow-sm border">
                        <div className="flex items-center justify-between p-6 border-b">
                          <div className="flex items-center space-x-4">
                            <button 
                              onClick={() => navigateMonth(-1)}
                              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                            >
                              â†
                            </button>
                            <h2 className="text-xl font-semibold text-gray-900">
                              {getViewTitle()}
                            </h2>
                            <button 
                              onClick={() => navigateMonth(1)}
                              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                            >
                              â†’
                            </button>
                          </div>
                        </div>

                        <div className="p-6">
                          {renderCalendarContent()}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ) : (
                renderTeamMembersView()
              )}">{employee.name}</h3>
                                  <p className="text-sm text-gray-500">{employee.department}</p>
                                </div>
                              </div>
                              
                              <div className="space-y-2">
                                <div className="flex justify-between text-sm">
                                  <span className="text-gray-600">Used:</span>
                                  <span className="font-medium">{formatHours(employee.usedLeave)}</span>
                                </div>
                                <div className="flex justify-between text-sm">
                                  <span className="text-gray-600">Remaining:</span>
                                  <span className="font-medium text-green-600">{formatHours(remainingHours)}</span>
                                </div>
                                
                                <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                                  <div 
                                    className="h-2 rounded-full transition-all duration-300"
                                    style={{ 
                                      width: `${usagePercentage}%`,
                                      backgroundColor: employee.color 
                                    }}
                                  />
                                </div>
                                <div className="text-xs text-gray-500 text-center">
                                  {usagePercentage.toFixed(1)}% used
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  </div>

                  {/* Calendar */}
                  <div className="lg:col-span-3">
                    <div className="bg-white rounded-xl shadow-sm border">
                      <div className="flex items-center justify-between p-6 border-b">
                        <div className="flex items-center space-x-4">
                          <button 
                            onClick={() => navigateMonth(-1)}
                            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                          >
                            â†
                          </button>
                          <h2 className="text-xl font-semibold text-gray-900">
                            {getViewTitle()}
                          </h2>
                          <button 
                            onClick={() => navigateMonth(1)}
                            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                          >
                            â†’
                          </button>
                        </div>
                      </div>

                      <div className="p-6">
                        {renderCalendarContent()}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Employee Modal */}
              {showEmployeeModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-md">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold">
                        {editingEmployee ? 'Edit Employee' : 'Add New Employee'}
                      </h3>
                      <button 
                        onClick={closeEmployeeModal}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        âœ•
                      </button>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Full Name *
                        </label>
                        <input
                          type="text"
                          value={employeeForm.name}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, name: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          placeholder="e.g., John Smith"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Department *
                        </label>
                        <select
                          value={employeeForm.department}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, department: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="">Select Department</option>
                          <option value="Workshop">Workshop</option>
                          <option value="Finishing">Finishing</option>
                          <option value="Administration">Administration</option>
                          <option value="Sales">Sales</option>
                          <option value="Quality Control">Quality Control</option>
                          <option value="Design">Design</option>
                          <option value="Maintenance">Maintenance</option>
                        </select>
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Annual Leave Allocation (hours)
                        </label>
                        <input
                          type="number"
                          value={employeeForm.totalLeave}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, totalLeave: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          min="0"
                          max="400"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Leave Used (hours)
                        </label>
                        <input
                          type="number"
                          value={employeeForm.usedLeave}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, usedLeave: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          min="0"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Avatar Color
                        </label>
                        <div className="flex flex-wrap gap-2">
                          {colorOptions.map(color => (
                            <button
                              key={color}
                              type="button"
                              onClick={() => setEmployeeForm(prev => ({...prev, color}))}
                              className={`w-8 h-8 rounded-full border-2 transition-all ${
                                employeeForm.color === color ? 'border-gray-800 scale-110' : 'border-gray-300'
                              }`}
                              style={{ backgroundColor: color }}
                            />
                          ))}
                        </div>
                      </div>
                      
                      <div className="flex justify-end space-x-3 pt-4">
                        <button 
                          onClick={closeEmployeeModal}
                          className="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={saveEmployee}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          {editingEmployee ? 'Update Employee' : 'Add Employee'}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Quick Leave Modal */}
              {showQuickLeaveModal && selectedDate && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-md">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold">
                        Quick Add Leave - {selectedDate.toLocaleDateString()}
                      </h3>
                      <button 
                        onClick={closeQuickLeaveModal}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        âœ•
                      </button>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Employee
                        </label>
                        <select
                          value={quickLeaveForm.employeeId}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, employeeId: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          {employees.map(emp => (
                            <option key={emp.id} value={emp.id}>
                              {emp.name}
                            </option>
                          ))}
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Number of Days
                        </label>
                        <select
                          value={quickLeaveForm.days}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, days: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="1">1 Day (8 hours)</option>
                          <option value="2">2 Days (16 hours)</option>
                          <option value="3">3 Days (24 hours)</option>
                          <option value="5">5 Days (40 hours)</option>
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Leave Type
                        </label>
                        <select
                          value={quickLeaveForm.type}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, type: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="Annual Leave">Annual Leave</option>
                          <option value="Sick Leave">Sick Leave</option>
                          <option value="Personal Leave">Personal Leave</option>
                        </select>
                      </div>
                      
                      <div className="flex justify-end space-x-3 pt-4">
                        <button 
                          onClick={closeQuickLeaveModal}
                          className="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={saveQuickLeave}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          Add Leave
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Render the app
        ReactDOM.render(<LeaveCalendar />, document.getElementById('root'));
    </script>
</body>
</html>
