<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Atkin Guitars Leave Calendar (Patched)</title>
  <link rel="icon" href="data:,">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  <script type="text/babel">
    // Minimal patched skeleton with preserved dbApi calls placeholder
    const { useState } = React;
    const isSameDay=(a,b)=>a.toDateString()===b.toDateString();
    const isWeekend=(d)=>d.getDay()===0||d.getDay()===6;
    const isWorkingDay=(d)=>!isWeekend(d);
    const isoDate=(d)=> new Date(d.getFullYear(),d.getMonth(),d.getDate()).toISOString().slice(0,10);
    const effectiveHours=(leave,date)=>{
      if(!leave) return 0;
      if(Array.isArray(leave.excludedDates)&&leave.excludedDates.includes(isoDate(date))) return 0;
      const h=leave.hours||0;
      const s=new Date(leave.startDate), e=new Date(leave.endDate);
      if(h>0&&h<8) return isSameDay(date,s)?h:0;
      if(date>=s&&date<=e&&isWorkingDay(date)) return 8;
      return 0;
    };
    const firstValidDate=(leave,fromDate=new Date())=>{
      if(!leave) return null;
      const s=new Date(leave.startDate), e=new Date(leave.endDate);
      const cur=new Date(Math.max(+fromDate,+s));
      while(cur<=e){
        if(isWorkingDay(cur)&&effectiveHours(leave,cur)>0) return new Date(cur);
        cur.setDate(cur.getDate()+1);
      }
      return null;
    };
    const dbApi = { createLeaveRequest: async()=>{}, deleteLeaveRequest: async()=>{} };
    const App=()=>{
      const [leaveRequests] = useState([]);
      const nextUpcomingFor=(empId)=>{
        const today=new Date(), t0=new Date(today.getFullYear(),today.getMonth(),today.getDate());
        const candidates=leaveRequests
          .filter(l=>l.employeeId===empId)
          .map(l=>({leave:l,next:firstValidDate(l,t0)}))
          .filter(x=>!!x.next)
          .sort((a,b)=>a.next-b.next);
        return candidates.length?{...candidates[0].leave,_nextDate:candidates[0].next}:null;
      };
      return <div>Calendar Placeholder (patched build)</div>;
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>