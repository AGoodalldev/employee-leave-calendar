<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leave Calendar (Full Patched)</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  <script type="text/babel">

    const { useState, useMemo } = React;

    // -----------------
    // Bank Holidays Fix
    // -----------------
    function easter(year) {
      const f = Math.floor,
            G = year % 19,
            C = f(year / 100),
            H = (C - f(C / 4) - f((8 * C + 13) / 25) + 19 * G + 15) % 30,
            I = H - f(H / 28) * (1 - f(29 / (H + 1)) * f((21 - G) / 11));
      const day = I - ((year + f(year / 4) + I + 2 - C + f(C / 4)) % 7) + 28;
      const month = 3;
      return new Date(year, month - 1, day);
    }

    function bankHolidays(year) {
      const easterSunday = easter(year);
      const goodFriday = new Date(easterSunday); goodFriday.setDate(goodFriday.getDate() - 2);
      const easterMonday = new Date(easterSunday); easterMonday.setDate(easterMonday.getDate() + 1);
      return [
        { name: "New Year's Day", date: new Date(year, 0, 1) },
        { name: "Good Friday", date: goodFriday },
        { name: "Easter Monday", date: easterMonday },
        { name: "Early May Bank Holiday", date: new Date(year, 4, 1) },
        { name: "Spring Bank Holiday", date: new Date(year, 4, 31) },
        { name: "Summer Bank Holiday", date: new Date(year, 7, 31) },
        { name: "Christmas Day", date: new Date(year, 11, 25) },
        { name: "Boxing Day", date: new Date(year, 11, 26) },
      ];
    }

    function isBankHoliday(date) {
      return bankHolidays(date.getFullYear()).some(h =>
        h.date.toDateString() === date.toDateString()
      );
    }

    function isWorkingDay(date) {
      const day = date.getDay();
      return day !== 0 && day !== 6 && !isBankHoliday(date);
    }

    // -----------------
    // Demo App
    // -----------------
    function App() {
      const [leaves] = useState([
        { id: 1, employee: "Andy", type: "Annual Leave", hours: 8, startDate: "2025-08-18" },
        { id: 2, employee: "Andy", type: "Annual Leave", hours: 4, startDate: "2025-08-27" }
      ]);

      const formatDuration = (hours) => {
        if (hours >= 8) return "Full Day";
        if (hours === 4) return "Half Day";
        return hours + "h";
      };

      return (
        <div className="p-6">
          <h1 className="text-lg font-bold mb-4">Leave Calendar (Demo)</h1>
          {leaves.map(l => (
            <div key={l.id} className="bg-green-100 p-2 mb-2 rounded">
              <strong>{l.employee}</strong> — {l.type} • {formatDuration(l.hours)} • {l.startDate}
            </div>
          ))}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>