<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atkin Guitars Leave Calendar</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        }
        /* Loading indicator */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">Loading Atkin Guitars Leave Calendar...</div>
    </div>

    <script type="text/babel">
        const { useState, useMemo } = React;
        
        // Simple icon components to replace lucide-react
        const Calendar = ({ className, style }) => (
            <svg className={className} style={style} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const Clock = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const Users = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
            </svg>
        );

        const Settings = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const Download = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        );

        const Plus = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
        );

        const Filter = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z" />
            </svg>
        );

        const Search = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const Edit = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
        );

        const UserPlus = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
            </svg>
        );

        const Trash = ({ className }) => (
            <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const LeaveCalendar = () => {
          const [currentDate, setCurrentDate] = useState(new Date());
          const [viewMode, setViewMode] = useState('month');
          const [selectedEmployee, setSelectedEmployee] = useState('all');
          const [showSettings, setShowSettings] = useState(false);
          const [showEmployeeModal, setShowEmployeeModal] = useState(false);
          const [showLeaveModal, setShowLeaveModal] = useState(false);
          const [showQuickLeaveModal, setShowQuickLeaveModal] = useState(false);
          const [selectedDate, setSelectedDate] = useState(null);
          const [editingEmployee, setEditingEmployee] = useState(null);
          const [searchTerm, setSearchTerm] = useState('');
          
          const [employees, setEmployees] = useState([
            {
              id: 1,
              name: 'Sarah Johnson',
              department: 'Workshop',
              totalLeave: 200,
              usedLeave: 64,
              avatar: 'SJ',
              color: '#3B82F6'
            },
            {
              id: 2,
              name: 'Michael Chen',
              department: 'Finishing',
              totalLeave: 160,
              usedLeave: 32,
              avatar: 'MC',
              color: '#10B981'
            },
            {
              id: 3,
              name: 'Emma Davis',
              department: 'Administration',
              totalLeave: 180,
              usedLeave: 96,
              avatar: 'ED',
              color: '#F59E0B'
            },
            {
              id: 4,
              name: 'James Wilson',
              department: 'Sales',
              totalLeave: 200,
              usedLeave: 48,
              avatar: 'JW',
              color: '#EF4444'
            }
          ]);

          const [leaveRequests, setLeaveRequests] = useState([
            {
              id: 1,
              employeeId: 1,
              startDate: new Date(2025, 7, 25),
              endDate: new Date(2025, 7, 29),
              type: 'Annual Leave',
              status: 'approved',
              hours: 40
            },
            {
              id: 2,
              employeeId: 2,
              startDate: new Date(2025, 8, 2),
              endDate: new Date(2025, 8, 6),
              type: 'Sick Leave',
              status: 'approved',
              hours: 40
            },
            {
              id: 3,
              employeeId: 3,
              startDate: new Date(2025, 8, 15),
              endDate: new Date(2025, 8, 16),
              type: 'Personal Leave',
              status: 'pending',
              hours: 16
            }
          ]);

          const [companyBranding] = useState({
            companyName: 'Atkin Guitars',
            primaryColor: '#3B82F6',
            logo: null
          });

          const [employeeForm, setEmployeeForm] = useState({
            name: '',
            department: '',
            totalLeave: 160,
            usedLeave: 0,
            color: '#3B82F6'
          });

          const [leaveForm, setLeaveForm] = useState({
            employeeId: '',
            startDate: '',
            endDate: '',
            type: 'Annual Leave',
            timeEntry: 'days', // 'days' or 'hours'
            days: 1,
            hours: 8,
            notes: ''
          });

          // Predefined colors for employees
          const colorOptions = [
            '#3B82F6', '#10B981', '#F59E0B', '#EF4444', 
            '#8B5CF6', '#06B6D4', '#84CC16', '#F97316',
            '#EC4899', '#6366F1', '#14B8A6', '#F59E0B'
          ];

          // Generate initials from name
          const generateInitials = (name) => {
            return name.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
          };

          const filteredEmployees = useMemo(() => {
            return employees.filter(emp => 
              emp.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
              emp.department.toLowerCase().includes(searchTerm.toLowerCase())
            );
          }, [employees, searchTerm]);

          const getCalendarDays = () => {
            if (viewMode === 'week') {
              return getWeekDays();
            } else if (viewMode === 'year') {
              return getYearMonths();
            } else {
              return getMonthDays();
            }
          };

          const getMonthDays = () => {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const days = [];
            const currentDay = new Date(startDate);
            
            for (let i = 0; i < 42; i++) {
              days.push(new Date(currentDay));
              currentDay.setDate(currentDay.getDate() + 1);
            }
            
            return days;
          };

          const getWeekDays = () => {
            const startOfWeek = new Date(currentDate);
            const day = startOfWeek.getDay();
            startOfWeek.setDate(currentDate.getDate() - day);
            
            const days = [];
            for (let i = 0; i < 7; i++) {
              const day = new Date(startOfWeek);
              day.setDate(startOfWeek.getDate() + i);
              days.push(day);
            }
            return days;
          };

          const getYearMonths = () => {
            const year = currentDate.getFullYear();
            const months = [];
            for (let i = 0; i < 12; i++) {
              months.push(new Date(year, i, 1));
            }
            return months;
          };

          const getLeaveForDate = (date) => {
            return leaveRequests.filter(leave => {
              const leaveStart = new Date(leave.startDate);
              const leaveEnd = new Date(leave.endDate);
              return date >= leaveStart && date <= leaveEnd;
            });
          };

          const formatHours = (hours) => {
            const days = Math.floor(hours / 8);
            const remainingHours = hours % 8;
            return remainingHours > 0 ? `${days}d ${remainingHours}h` : `${days}d`;
          };

          const getStatusColor = (status) => {
            switch(status) {
              case 'approved': return 'bg-green-100 text-green-800';
              case 'pending': return 'bg-yellow-100 text-yellow-800';
              case 'rejected': return 'bg-red-100 text-red-800';
              default: return 'bg-gray-100 text-gray-800';
            }
          };

          const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
          ];

          const navigateMonth = (direction) => {
            setCurrentDate(prev => {
              const newDate = new Date(prev);
              if (viewMode === 'week') {
                newDate.setDate(prev.getDate() + (direction * 7));
              } else if (viewMode === 'year') {
                newDate.setFullYear(prev.getFullYear() + direction);
              } else {
                newDate.setMonth(prev.getMonth() + direction);
              }
              return newDate;
            });
          };

          const getViewTitle = () => {
            if (viewMode === 'week') {
              const startOfWeek = new Date(currentDate);
              const day = startOfWeek.getDay();
              startOfWeek.setDate(currentDate.getDate() - day);
              const endOfWeek = new Date(startOfWeek);
              endOfWeek.setDate(startOfWeek.getDate() + 6);
              
              if (startOfWeek.getMonth() === endOfWeek.getMonth()) {
                return `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()}-${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
              } else {
                return `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()} - ${monthNames[endOfWeek.getMonth()]} ${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
              }
            } else if (viewMode === 'year') {
              return currentDate.getFullYear().toString();
            } else {
              return `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            }
          };

          const getGridColumns = () => {
            if (viewMode === 'week') return 'grid-cols-7';
            if (viewMode === 'year') return 'grid-cols-4';
            return 'grid-cols-7';
          };

          const renderCalendarContent = () => {
            const days = getCalendarDays();
            
            if (viewMode === 'year') {
              return (
                <div className={`grid ${getGridColumns()} gap-4`}>
                  {days.map((month, index) => {
                    const monthLeaves = leaveRequests.filter(leave => {
                      const leaveStart = new Date(leave.startDate);
                      return leaveStart.getMonth() === month.getMonth() && leaveStart.getFullYear() === month.getFullYear();
                    });
                    
                    return (
                      <div key={index} className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" 
                           onClick={() => {
                             setCurrentDate(month);
                             setViewMode('month');
                           }}>
                        <h3 className="font-medium text-gray-900 mb-2">{monthNames[month.getMonth()]}</h3>
                        <div className="space-y-1">
                          {monthLeaves.slice(0, 3).map(leave => {
                            const employee = employees.find(emp => emp.id === leave.employeeId);
                            if (!employee) return null;
                            return (
                              <div key={leave.id} className={`text-xs px-2 py-1 rounded ${getStatusColor(leave.status)}`}>
                                {employee.name.split(' ')[0]}
                              </div>
                            );
                          })}
                          {monthLeaves.length > 3 && (
                            <div className="text-xs text-gray-500">+{monthLeaves.length - 3} more</div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              );
            } else {
              return (
                <>
                  <div className={`grid ${getGridColumns()} gap-1 mb-2`}>
                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                      <div key={day} className="p-3 text-center text-sm font-medium text-gray-500">
                        {day}
                      </div>
                    ))}
                  </div>
                  <div className={`grid ${getGridColumns()} gap-1`}>
                    {days.map((date, index) => {
                      const isCurrentMonth = viewMode === 'week' || date.getMonth() === currentDate.getMonth();
                      const isToday = date.toDateString() === new Date().toDateString();
                      const dayLeaves = getLeaveForDate(date);
                      
                      return (
                        <div
                          key={index}
                          className={`${viewMode === 'week' ? 'min-h-[120px]' : 'min-h-[96px]'} p-2 border border-gray-200 hover:bg-gray-50 transition-colors relative group ${
                            !isCurrentMonth ? 'bg-gray-50 text-gray-400' : ''
                          } ${isToday ? 'bg-blue-50 border-blue-200' : ''}`}
                        >
                          <div className="flex justify-between items-center mb-1">
                            <div className={`text-sm font-medium ${
                              isToday ? 'text-blue-600' : isCurrentMonth ? 'text-gray-900' : 'text-gray-400'
                            }`}>
                              {viewMode === 'week' ? `${monthNames[date.getMonth()].slice(0,3)} ${date.getDate()}` : date.getDate()}
                            </div>
                            {isCurrentMonth && (
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  openQuickLeaveModal(date);
                                }}
                                className="opacity-0 group-hover:opacity-100 transition-opacity w-5 h-5 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs hover:bg-blue-600"
                                title="Add leave for this day"
                              >
                                +
                              </button>
                            )}
                          </div>
                          
                          <div className="space-y-1">
                            {dayLeaves.map(leave => {
                              const employee = employees.find(emp => emp.id === leave.employeeId);
                              if (!employee) return null;
                              
                              return (
                                <div
                                  key={`${leave.id}-${date.getTime()}`}
                                  className={`text-xs px-2 py-1 rounded text-center truncate ${getStatusColor(leave.status)}`}
                                  title={`${employee.name} - ${leave.type}`}
                                >
                                  {employee.name.split(' ')[0]}
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </>
              );
            }
          };

          const openEmployeeModal = (employee = null) => {
            if (employee) {
              setEditingEmployee(employee);
              setEmployeeForm({
                name: employee.name,
                department: employee.department,
                totalLeave: employee.totalLeave,
                usedLeave: employee.usedLeave,
                color: employee.color
              });
            } else {
              setEditingEmployee(null);
              setEmployeeForm({
                name: '',
                department: '',
                totalLeave: 160,
                usedLeave: 0,
                color: colorOptions[employees.length % colorOptions.length]
              });
            }
            setShowEmployeeModal(true);
          };

          const closeEmployeeModal = () => {
            setShowEmployeeModal(false);
            setEditingEmployee(null);
            setEmployeeForm({
              name: '',
              department: '',
              totalLeave: 160,
              usedLeave: 0,
              color: '#3B82F6'
            });
          };

          const saveEmployee = () => {
            if (!employeeForm.name.trim() || !employeeForm.department.trim()) {
              alert('Please fill in all required fields');
              return;
            }

            if (editingEmployee) {
              // Update existing employee
              setEmployees(prev => prev.map(emp => 
                emp.id === editingEmployee.id 
                  ? {
                      ...emp,
                      name: employeeForm.name,
                      department: employeeForm.department,
                      totalLeave: parseInt(employeeForm.totalLeave),
                      usedLeave: parseInt(employeeForm.usedLeave),
                      color: employeeForm.color,
                      avatar: generateInitials(employeeForm.name)
                    }
                  : emp
              ));
            } else {
              // Add new employee
              const newId = Math.max(...employees.map(emp => emp.id)) + 1;
              const newEmployee = {
                id: newId,
                name: employeeForm.name,
                department: employeeForm.department,
                totalLeave: parseInt(employeeForm.totalLeave),
                usedLeave: parseInt(employeeForm.usedLeave),
                avatar: generateInitials(employeeForm.name),
                color: employeeForm.color
              };
              setEmployees(prev => [...prev, newEmployee]);
            }
            
            closeEmployeeModal();
          };

          const deleteEmployee = (employeeId) => {
            if (confirm('Are you sure you want to delete this employee?')) {
              setEmployees(prev => prev.filter(emp => emp.id !== employeeId));
            }
          };

          // Leave Management Functions
          const openLeaveModal = () => {
            // Set default start date to today
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            setLeaveForm({
              employeeId: employees.length > 0 ? employees[0].id.toString() : '',
              startDate: today.toISOString().split('T')[0],
              endDate: tomorrow.toISOString().split('T')[0],
              type: 'Annual Leave',
              timeEntry: 'days',
              days: 1,
              hours: 8,
              notes: ''
            });
            setShowLeaveModal(true);
          };

          const closeLeaveModal = () => {
            setShowLeaveModal(false);
            setLeaveForm({
              employeeId: '',
              startDate: '',
              endDate: '',
              type: 'Annual Leave',
              timeEntry: 'days',
              days: 1,
              hours: 8,
              notes: ''
            });
          };

          const calculateLeaveDays = () => {
            if (!leaveForm.startDate || !leaveForm.endDate) return 0;
            
            const start = new Date(leaveForm.startDate);
            const end = new Date(leaveForm.endDate);
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 to include both start and end date
            return diffDays;
          };

          const calculateLeaveHours = () => {
            if (leaveForm.timeEntry === 'hours') {
              return parseInt(leaveForm.hours) || 0;
            } else {
              const days = calculateLeaveDays();
              return days * 8; // 8 hours per day
            }
          };

          const saveLeaveRequest = () => {
            if (!leaveForm.employeeId || !leaveForm.startDate || !leaveForm.endDate) {
              alert('Please fill in all required fields');
              return;
            }

            const startDate = new Date(leaveForm.startDate);
            const endDate = new Date(leaveForm.endDate);
            
            if (endDate < startDate) {
              alert('End date cannot be before start date');
              return;
            }

            const totalHours = calculateLeaveHours();
            const employee = employees.find(emp => emp.id === parseInt(leaveForm.employeeId));
            
            if (!employee) {
              alert('Please select a valid employee');
              return;
            }

            // Check if employee has enough leave remaining
            const remainingLeave = employee.totalLeave - employee.usedLeave;
            if (totalHours > remainingLeave) {
              alert(`Employee only has ${formatHours(remainingLeave)} remaining. This request requires ${formatHours(totalHours)}.`);
              return;
            }

            // Create new leave request
            const newLeaveRequest = {
              id: Math.max(...leaveRequests.map(req => req.id), 0) + 1,
              employeeId: parseInt(leaveForm.employeeId),
              startDate: startDate,
              endDate: endDate,
              type: leaveForm.type,
              status: 'pending',
              hours: totalHours,
              notes: leaveForm.notes
            };

            // Add leave request
            setLeaveRequests(prev => [...prev, newLeaveRequest]);

            // Update employee's used leave
            setEmployees(prev => prev.map(emp => 
              emp.id === parseInt(leaveForm.employeeId)
                ? { ...emp, usedLeave: emp.usedLeave + totalHours }
                : emp
            ));

            closeLeaveModal();
          };

          // Quick Leave Functions
          const openQuickLeaveModal = (date) => {
            setSelectedDate(date);
            setQuickLeaveForm({
              employeeId: employees.length > 0 ? employees[0].id.toString() : '',
              days: 1,
              type: 'Annual Leave'
            });
            setShowQuickLeaveModal(true);
          };

          const closeQuickLeaveModal = () => {
            setShowQuickLeaveModal(false);
            setSelectedDate(null);
            setQuickLeaveForm({
              employeeId: '',
              days: 1,
              type: 'Annual Leave'
            });
          };

          const saveQuickLeave = () => {
            if (!quickLeaveForm.employeeId || !selectedDate) {
              alert('Please select an employee');
              return;
            }

            const days = parseInt(quickLeaveForm.days) || 1;
            const totalHours = days * 8;
            const employee = employees.find(emp => emp.id === parseInt(quickLeaveForm.employeeId));
            
            if (!employee) {
              alert('Please select a valid employee');
              return;
            }

            // Check if employee has enough leave remaining
            const remainingLeave = employee.totalLeave - employee.usedLeave;
            if (totalHours > remainingLeave) {
              alert(`Employee only has ${formatHours(remainingLeave)} remaining. This request requires ${formatHours(totalHours)}.`);
              return;
            }

            // Calculate end date based on number of days
            const startDate = new Date(selectedDate);
            const endDate = new Date(selectedDate);
            
            // Skip weekends when calculating business days
            let daysToAdd = days - 1; // -1 because start date counts as day 1
            let currentDate = new Date(startDate);
            
            while (daysToAdd > 0) {
              currentDate.setDate(currentDate.getDate() + 1);
              // Skip weekends (0 = Sunday, 6 = Saturday)
              if (currentDate.getDay() !== 0 && currentDate.getDay() !== 6) {
                daysToAdd--;
              }
            }
            
            // For single day leave, end date = start date
            if (days === 1) {
              endDate.setTime(startDate.getTime());
            } else {
              endDate.setTime(currentDate.getTime());
            }

            // Create new leave request
            const newLeaveRequest = {
              id: Math.max(...leaveRequests.map(req => req.id), 0) + 1,
              employeeId: parseInt(quickLeaveForm.employeeId),
              startDate: startDate,
              endDate: endDate,
              type: quickLeaveForm.type,
              status: 'pending',
              hours: totalHours,
              notes: `Quick add: ${days} day${days > 1 ? 's' : ''} starting ${startDate.toLocaleDateString()}`
            };

            // Add leave request
            setLeaveRequests(prev => [...prev, newLeaveRequest]);

            // Update employee's used leave
            setEmployees(prev => prev.map(emp => 
              emp.id === parseInt(quickLeaveForm.employeeId)
                ? { ...emp, usedLeave: emp.usedLeave + totalHours }
                : emp
            ));

            closeQuickLeaveModal();
          };

          return (
            <div className="min-h-screen bg-gray-50">
              <div className="bg-white shadow-sm border-b">
                <div className="max-w-7xl mx-auto px-6 py-4">
                  <div className="flex items-center justify-between flex-wrap gap-4">
                    <div className="flex items-center space-x-4">
                      <div className="flex items-center space-x-2">
                        <Calendar className="h-8 w-8" style={{ color: companyBranding.primaryColor }} />
                        <h1 className="text-2xl font-bold text-gray-900">{companyBranding.companyName} Leave Calendar</h1>
                      </div>
                    </div>
                    
                    <div className="flex items-center space-x-4 flex-wrap">
                      <div className="relative">
                        <Search className="h-4 w-4 absolute left-3 top-3 text-gray-400" />
                        <input
                          type="text"
                          placeholder="Search employees..."
                          value={searchTerm}
                          onChange={(e) => setSearchTerm(e.target.value)}
                          className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>
                      
                      <select
                        value={selectedEmployee}
                        onChange={(e) => setSelectedEmployee(e.target.value)}
                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      >
                        <option value="all">All Employees</option>
                        {employees.map(emp => (
                          <option key={emp.id} value={emp.id}>{emp.name}</option>
                        ))}
                      </select>
                      
                      <div className="flex bg-gray-100 rounded-lg p-1">
                        {['week', 'month', 'year'].map(mode => (
                          <button
                            key={mode}
                            onClick={() => setViewMode(mode)}
                            className={`px-3 py-1 rounded-md text-sm font-medium capitalize transition-colors ${
                              viewMode === mode 
                                ? 'bg-white text-gray-900 shadow-sm' 
                                : 'text-gray-600 hover:text-gray-900'
                            }`}
                          >
                            {mode}
                          </button>
                        ))}
                      </div>
                      
                      <button 
                        onClick={() => openEmployeeModal()}
                        className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                      >
                        <UserPlus className="h-4 w-4" />
                        <span>Add Employee</span>
                      </button>
                      
                      <button 
                        onClick={openLeaveModal}
                        className="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                      >
                        <Plus className="h-4 w-4" />
                        <span>Add Leave</span>
                      </button>
                      
                      <button 
                        onClick={() => setShowSettings(!showSettings)}
                        className="p-2 text-gray-400 hover:text-gray-600 transition-colors"
                      >
                        <Settings className="h-5 w-5" />
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div className="max-w-7xl mx-auto px-6 py-8">
                <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
                  <div className="lg:col-span-1">
                    <div className="bg-white rounded-xl shadow-sm border p-6">
                      <div className="flex items-center justify-between mb-6">
                        <h2 className="text-lg font-semibold text-gray-900">Team Overview</h2>
                        <Users className="h-5 w-5 text-gray-400" />
                      </div>
                      
                      <div className="space-y-4">
                        {filteredEmployees.map(employee => {
                          const remainingHours = employee.totalLeave - employee.usedLeave;
                          const usagePercentage = (employee.usedLeave / employee.totalLeave) * 100;
                          
                          return (
                            <div 
                              key={employee.id}
                              className="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow cursor-pointer relative group"
                              onClick={() => setSelectedEmployee(employee.id.toString())}
                            >
                              <div className="absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    openEmployeeModal(employee);
                                  }}
                                  className="p-1 text-gray-400 hover:text-blue-600 transition-colors"
                                >
                                  <Edit className="h-4 w-4" />
                                </button>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    deleteEmployee(employee.id);
                                  }}
                                  className="p-1 text-gray-400 hover:text-red-600 transition-colors"
                                >
                                  <Trash className="h-4 w-4" />
                                </button>
                              </div>
                              
                              <div className="flex items-center space-x-3 mb-3">
                                <div 
                                  className="w-10 h-10 rounded-full flex items-center justify-center text-white font-medium"
                                  style={{ backgroundColor: employee.color }}
                                >
                                  {employee.avatar}
                                </div>
                                <div className="flex-1">
                                  <h3 className="font-medium text-gray-900">{employee.name}</h3>
                                  <p className="text-sm text-gray-500">{employee.department}</p>
                                </div>
                              </div>
                              
                              <div className="space-y-2">
                                <div className="flex justify-between text-sm">
                                  <span className="text-gray-600">Used:</span>
                                  <span className="font-medium">{formatHours(employee.usedLeave)}</span>
                                </div>
                                <div className="flex justify-between text-sm">
                                  <span className="text-gray-600">Remaining:</span>
                                  <span className="font-medium text-green-600">{formatHours(remainingHours)}</span>
                                </div>
                                
                                <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                                  <div 
                                    className="h-2 rounded-full transition-all duration-300"
                                    style={{ 
                                      width: `${usagePercentage}%`,
                                      backgroundColor: employee.color 
                                    }}
                                  />
                                </div>
                                <div className="text-xs text-gray-500 text-center">
                                  {usagePercentage.toFixed(1)}% used
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  </div>

                  <div className="lg:col-span-3">
                    <div className="bg-white rounded-xl shadow-sm border">
                      <div className="flex items-center justify-between p-6 border-b flex-wrap gap-4">
                        <div className="flex items-center space-x-4">
                          <button 
                            onClick={() => navigateMonth(-1)}
                            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                          >
                            ←
                          </button>
                          <h2 className="text-xl font-semibold text-gray-900">
                            {getViewTitle()}
                          </h2>
                          <button 
                            onClick={() => navigateMonth(1)}
                            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                          >
                            →
                          </button>
                        </div>
                        
                        <div className="flex items-center space-x-2">
                          <button className="flex items-center space-x-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors">
                            <Download className="h-4 w-4" />
                            <span>Export</span>
                          </button>
                          <button className="flex items-center space-x-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors">
                            <Filter className="h-4 w-4" />
                            <span>Filter</span>
                          </button>
                        </div>
                      </div>

                      <div className="p-6">
                        {renderCalendarContent()}
                      </div>
                    </div>

                    <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div className="bg-white rounded-xl shadow-sm border p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm font-medium text-gray-600">Total Leave Requests</p>
                            <p className="text-2xl font-bold text-gray-900">{leaveRequests.length}</p>
                          </div>
                          <Clock className="h-8 w-8 text-blue-500" />
                        </div>
                      </div>
                      
                      <div className="bg-white rounded-xl shadow-sm border p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm font-medium text-gray-600">Pending Approvals</p>
                            <p className="text-2xl font-bold text-yellow-600">
                              {leaveRequests.filter(req => req.status === 'pending').length}
                            </p>
                          </div>
                          <Filter className="h-8 w-8 text-yellow-500" />
                        </div>
                      </div>
                      
                      <div className="bg-white rounded-xl shadow-sm border p-6">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm font-medium text-gray-600">Team Utilization</p>
                            <p className="text-2xl font-bold text-green-600">
                              {employees.length > 0 ? Math.round(employees.reduce((acc, emp) => acc + (emp.usedLeave / emp.totalLeave * 100), 0) / employees.length) : 0}%
                            </p>
                          </div>
                          <Users className="h-8 w-8 text-green-500" />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Quick Leave Modal */}
              {showQuickLeaveModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-md">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold">
                        Quick Add Leave - {selectedDate?.toLocaleDateString()}
                      </h3>
                      <button 
                        onClick={closeQuickLeaveModal}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        ✕
                      </button>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Employee *
                        </label>
                        <select
                          value={quickLeaveForm.employeeId}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, employeeId: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="">Select Employee</option>
                          {employees.map(emp => {
                            const remaining = emp.totalLeave - emp.usedLeave;
                            return (
                              <option key={emp.id} value={emp.id}>
                                {emp.name} - {formatHours(remaining)} remaining
                              </option>
                            );
                          })}
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Number of Days
                        </label>
                        <select
                          value={quickLeaveForm.days}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, days: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="0.5">Half Day (4 hours)</option>
                          <option value="1">1 Day (8 hours)</option>
                          <option value="2">2 Days (16 hours)</option>
                          <option value="3">3 Days (24 hours)</option>
                          <option value="4">4 Days (32 hours)</option>
                          <option value="5">5 Days (40 hours)</option>
                          <option value="10">10 Days (80 hours)</option>
                          <option value="15">15 Days (120 hours)</option>
                          <option value="20">20 Days (160 hours)</option>
                        </select>
                        <p className="text-xs text-gray-500 mt-1">
                          Total hours: {(parseFloat(quickLeaveForm.days) * 8) || 0}h
                        </p>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Leave Type
                        </label>
                        <select
                          value={quickLeaveForm.type}
                          onChange={(e) => setQuickLeaveForm(prev => ({...prev, type: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="Annual Leave">Annual Leave</option>
                          <option value="Sick Leave">Sick Leave</option>
                          <option value="Personal Leave">Personal Leave</option>
                          <option value="Other">Other</option>
                        </select>
                      </div>

                      {selectedDate && quickLeaveForm.days && (
                        <div className="bg-blue-50 p-3 rounded-lg">
                          <div className="text-sm text-blue-800">
                            <strong>Leave Details:</strong>
                            <div className="mt-1">
                              Start: {selectedDate.toLocaleDateString()}
                              <br />
                              {(() => {
                                const days = parseFloat(quickLeaveForm.days);
                                if (days <= 1) {
                                  return `Duration: ${days === 0.5 ? 'Half day' : '1 day'}`;
                                } else {
                                  // Calculate business days end date
                                  const endDate = new Date(selectedDate);
                                  let daysToAdd = Math.floor(days) - 1;
                                  let currentDate = new Date(selectedDate);
                                  
                                  while (daysToAdd > 0) {
                                    currentDate.setDate(currentDate.getDate() + 1);
                                    if (currentDate.getDay() !== 0 && currentDate.getDay() !== 6) {
                                      daysToAdd--;
                                    }
                                  }
                                  
                                  return `End: ${currentDate.toLocaleDateString()} (${days} days)`;
                                }
                              })()}
                              <br />
                              Total: {(parseFloat(quickLeaveForm.days) * 8) || 0} hours
                            </div>
                          </div>
                        </div>
                      )}

                      {quickLeaveForm.employeeId && (
                        <div className="bg-gray-50 p-3 rounded-lg">
                          <div className="text-sm text-gray-700">
                            <strong>Employee Leave Balance:</strong>
                            {(() => {
                              const emp = employees.find(e => e.id === parseInt(quickLeaveForm.employeeId));
                              if (!emp) return null;
                              const remaining = emp.totalLeave - emp.usedLeave;
                              const requestHours = (parseFloat(quickLeaveForm.days) * 8) || 0;
                              const afterLeave = remaining - requestHours;
                              return (
                                <div className="mt-1">
                                  Current: {formatHours(remaining)} • After: {formatHours(afterLeave)}
                                  {afterLeave < 0 && (
                                    <div className="text-red-600 text-xs mt-1">⚠️ This request exceeds available leave</div>
                                  )}
                                </div>
                              );
                            })()}
                          </div>
                        </div>
                      )}
                      
                      <div className="flex justify-end space-x-3 pt-4">
                        <button 
                          onClick={closeQuickLeaveModal}
                          className="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={saveQuickLeave}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          Add Leave
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Leave Request Modal */}
              {showLeaveModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-lg">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold">Add Leave Request</h3>
                      <button 
                        onClick={closeLeaveModal}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        ✕
                      </button>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Employee *
                        </label>
                        <select
                          value={leaveForm.employeeId}
                          onChange={(e) => setLeaveForm(prev => ({...prev, employeeId: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="">Select Employee</option>
                          {employees.map(emp => {
                            const remaining = emp.totalLeave - emp.usedLeave;
                            return (
                              <option key={emp.id} value={emp.id}>
                                {emp.name} - {formatHours(remaining)} remaining
                              </option>
                            );
                          })}
                        </select>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Start Date *
                          </label>
                          <input
                            type="date"
                            value={leaveForm.startDate}
                            onChange={(e) => setLeaveForm(prev => ({...prev, startDate: e.target.value}))}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            End Date *
                          </label>
                          <input
                            type="date"
                            value={leaveForm.endDate}
                            onChange={(e) => setLeaveForm(prev => ({...prev, endDate: e.target.value}))}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Leave Type
                        </label>
                        <select
                          value={leaveForm.type}
                          onChange={(e) => setLeaveForm(prev => ({...prev, type: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="Annual Leave">Annual Leave</option>
                          <option value="Sick Leave">Sick Leave</option>
                          <option value="Personal Leave">Personal Leave</option>
                          <option value="Maternity Leave">Maternity Leave</option>
                          <option value="Paternity Leave">Paternity Leave</option>
                          <option value="Study Leave">Study Leave</option>
                          <option value="Compassionate Leave">Compassionate Leave</option>
                          <option value="Other">Other</option>
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Time Entry Method
                        </label>
                        <div className="flex bg-gray-100 rounded-lg p-1">
                          <button
                            type="button"
                            onClick={() => setLeaveForm(prev => ({...prev, timeEntry: 'days'}))}
                            className={`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors ${
                              leaveForm.timeEntry === 'days' 
                                ? 'bg-white text-gray-900 shadow-sm' 
                                : 'text-gray-600 hover:text-gray-900'
                            }`}
                          >
                            Days (Auto-calculate)
                          </button>
                          <button
                            type="button"
                            onClick={() => setLeaveForm(prev => ({...prev, timeEntry: 'hours'}))}
                            className={`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors ${
                              leaveForm.timeEntry === 'hours' 
                                ? 'bg-white text-gray-900 shadow-sm' 
                                : 'text-gray-600 hover:text-gray-900'
                            }`}
                          >
                            Manual Hours
                          </button>
                        </div>
                      </div>

                      {leaveForm.timeEntry === 'hours' ? (
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            Total Hours
                          </label>
                          <input
                            type="number"
                            value={leaveForm.hours}
                            onChange={(e) => setLeaveForm(prev => ({...prev, hours: e.target.value}))}
                            min="0.5"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          />
                        </div>
                      ) : (
                        <div className="bg-blue-50 p-3 rounded-lg">
                          <div className="text-sm text-blue-800">
                            <strong>Calculated Leave:</strong>
                            <div className="mt-1">
                              Days: {calculateLeaveDays()} • Hours: {calculateLeaveHours()} 
                              {leaveForm.startDate && leaveForm.endDate && (
                                <span className="block text-xs text-blue-600 mt-1">
                                  From {new Date(leaveForm.startDate).toLocaleDateString()} to {new Date(leaveForm.endDate).toLocaleDateString()}
                                </span>
                              )}
                            </div>
                          </div>
                        </div>
                      )}

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Notes (Optional)
                        </label>
                        <textarea
                          value={leaveForm.notes}
                          onChange={(e) => setLeaveForm(prev => ({...prev, notes: e.target.value}))}
                          rows="3"
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          placeholder="Additional notes or comments..."
                        />
                      </div>

                      {leaveForm.employeeId && (
                        <div className="bg-gray-50 p-3 rounded-lg">
                          <div className="text-sm text-gray-700">
                            <strong>Employee Leave Balance:</strong>
                            {(() => {
                              const emp = employees.find(e => e.id === parseInt(leaveForm.employeeId));
                              if (!emp) return null;
                              const remaining = emp.totalLeave - emp.usedLeave;
                              const afterLeave = remaining - calculateLeaveHours();
                              return (
                                <div className="mt-1">
                                  Current: {formatHours(remaining)} • After this request: {formatHours(afterLeave)}
                                  {afterLeave < 0 && (
                                    <div className="text-red-600 text-xs mt-1">⚠️ This request exceeds available leave</div>
                                  )}
                                </div>
                              );
                            })()}
                          </div>
                        </div>
                      )}
                      
                      <div className="flex justify-end space-x-3 pt-4">
                        <button 
                          onClick={closeLeaveModal}
                          className="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={saveLeaveRequest}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          Add Leave Request
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Employee Modal */}
              {showEmployeeModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-md">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold">
                        {editingEmployee ? 'Edit Employee' : 'Add New Employee'}
                      </h3>
                      <button 
                        onClick={closeEmployeeModal}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        ✕
                      </button>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Full Name *
                        </label>
                        <input
                          type="text"
                          value={employeeForm.name}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, name: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          placeholder="e.g., John Smith"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Department *
                        </label>
                        <select
                          value={employeeForm.department}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, department: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="">Select Department</option>
                          <option value="Workshop">Workshop</option>
                          <option value="Finishing">Finishing</option>
                          <option value="Administration">Administration</option>
                          <option value="Sales">Sales</option>
                          <option value="Quality Control">Quality Control</option>
                          <option value="Design">Design</option>
                          <option value="Maintenance">Maintenance</option>
                        </select>
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Annual Leave Allocation (hours)
                        </label>
                        <input
                          type="number"
                          value={employeeForm.totalLeave}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, totalLeave: e.target.value}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          min="0"
                          max="400"
                        />
                        <p className="text-xs text-gray-500 mt-1">
                          Standard: 160 hours (20 days), Senior: 200 hours (25 days)
                        </p>
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Leave Used (hours)
                        </label>
                        <input
                          type="number"
                          value={employeeForm.usedLeave}
                          onChange={(e) => setEmployeeForm(prev => ({...prev, usedLeave: Math.min(e.target.value, employeeForm.totalLeave)}))}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          min="0"
                          max={employeeForm.totalLeave}
                        />
                        <p className="text-xs text-gray-500 mt-1">
                          Remaining: {formatHours(employeeForm.totalLeave - employeeForm.usedLeave)}
                        </p>
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Avatar Color
                        </label>
                        <div className="flex flex-wrap gap-2">
                          {colorOptions.map(color => (
                            <button
                              key={color}
                              onClick={() => setEmployeeForm(prev => ({...prev, color}))}
                              className={`w-8 h-8 rounded-full border-2 transition-all ${
                                employeeForm.color === color ? 'border-gray-800 scale-110' : 'border-gray-300'
                              }`}
                              style={{ backgroundColor: color }}
                            />
                          ))}
                        </div>
                        <div className="mt-2 flex items-center space-x-2">
                          <div 
                            className="w-8 h-8 rounded-full flex items-center justify-center text-white font-medium text-sm"
                            style={{ backgroundColor: employeeForm.color }}
                          >
                            {employeeForm.name ? generateInitials(employeeForm.name) : '??'}
                          </div>
                          <span className="text-sm text-gray-600">Preview</span>
                        </div>
                      </div>
                      
                      <div className="flex justify-end space-x-3 pt-4">
                        <button 
                          onClick={closeEmployeeModal}
                          className="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={saveEmployee}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          {editingEmployee ? 'Update Employee' : 'Add Employee'}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Settings Modal */}
              {showSettings && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-xl p-6 w-full max-w-md">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-lg font-semibold">Calendar Settings</h3>
                      <button 
                        onClick={() => setShowSettings(false)}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        ✕
                      </button>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Company Name
                        </label>
                        <input
                          type="text"
                          defaultValue={companyBranding.companyName}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Primary Color
                        </label>
                        <input
                          type="color"
                          defaultValue={companyBranding.primaryColor}
                          className="w-full h-10 border border-gray-300 rounded-lg"
                        />
                      </div>
                      
                      <div className="flex justify-end space-x-3 pt-4">
                        <button 
                          onClick={() => setShowSettings(false)}
                          className="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={() => setShowSettings(false)}
                          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          Save Changes
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => {
            ReactDOM.render(<LeaveCalendar />, document.getElementById('root'));
          });
        } else {
          ReactDOM.render(<LeaveCalendar />, document.getElementById('root'));
        }
    </script>
</body>
</html>
